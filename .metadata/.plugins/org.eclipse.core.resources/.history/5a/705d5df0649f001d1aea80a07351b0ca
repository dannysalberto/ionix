package com.ionix.testdev.services;

import java.util.List;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.ionix.testdev.dao.UserRepository;
import com.ionix.testdev.dto.UserDTO;
import com.ionix.testdev.interfaces.IUser;
import com.ionix.testdev.model.User;
import com.ionix.testdev.responses.UserResponse;
import com.ionix.testdev.utils.ConvertDTO;

@Service
public class UserService implements IUser{
	
    Logger logger = LoggerFactory.getLogger(UserService.class);

	@Autowired
	UserRepository repo;
	
	@Autowired
	ConvertDTO convertDTO;

	@Override
	public User saveUser(UserDTO user) throws Exception {
		// TODO Auto-generated method stub
		User userToSave = User.builder()
				.email(user.getEmail())
				.name(user.getName())
				.phone(user.getPhone())
				.build();
		try {
			userToSave = repo.save(userToSave);
			return userToSave;
		}catch (Exception e) {
			// TODO: handle exception
			logger.error(e.getMessage());
			throw new Exception("Error al guardar");
		}
		
	}

	@Override
	@SuppressWarnings("unchecked")
	public List<UserResponse> listUsers() {
		// TODO Auto-generated method stub
		List<User> users = repo.findAll(); 
		return convertDTO.get(users, UserResponse.class);
	}

	@Override
	public UserResponse getUserByEmail(String email) {
		// TODO Auto-generated method stub
		User user = repo.findByEmail(email);
		return convertDTO.create(user, UserResponse.class);
	}

	@Override
	public boolean deleteUser(Integer id) {
		// TODO Auto-generated method stub
		try {
			repo.deleteById(id);
			return true;
		}catch (Exception e) {
			// TODO: handle exception
			logger.error(e.getMessage());
			return false;
		}
	}

}
